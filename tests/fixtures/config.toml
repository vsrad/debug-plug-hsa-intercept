[agent]
log = "-"

[debug-buffer]
size = 1048576
dump-file = "tests/tmp/debug_buffer"

[code-object-dump]
log = "tests/tmp/co_dump.log"
directory = "tests/tmp/"

[[code-object-swap]]
when-call-count = 1
load-file = "tests/tmp/replacement.co"
load-trap-handler-file = "tests/tmp/replacement.co"
exec-before-load = """bash -o pipefail -c '\
  perl tests/fixtures/breakpoint_trap.pl -ba $ASM_DBG_BUF_ADDR -bs $ASM_DBG_BUF_SIZE \
      -w v[tid_dump] -l 35 -t 2 tests/kernels/dbg_kernel.s \
  | /opt/rocm/bin/hcc -x assembler -target amdgcn--amdhsa -mcpu=`/opt/rocm/bin/rocminfo | grep -om1 gfx9..` -mno-code-object-v3 \
    -Itests/kernels/include -o tests/tmp/replacement.co -'"""

[[code-object-swap]]
when-crc = 0xCAFE666
load-file = "replacement.co"
  [[code-object-swap.symbol]]
  name = "conv2d"
  replacement-name = "conv2d_test_new"
  [[code-object-swap.symbol]]
  name = "conv2d_transpose"
  replacement-name = "conv2d_test_new_transpose"

[[code-object-swap]]
when-crc = 0xDEADBEEF
load-file = "replacement.co"
